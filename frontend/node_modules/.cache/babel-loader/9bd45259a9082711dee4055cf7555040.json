{"ast":null,"code":"const refProps = ['type', 'source', 'source-layer', 'minzoom', 'maxzoom', 'filter', 'layout']; // Prepare a map style object for diffing\n// If immutable - convert to plain object\n// Work around some issues in older styles that would fail Mapbox's diffing\n\nexport function normalizeStyle(style) {\n  if (!style) {\n    return null;\n  }\n\n  if (typeof style === 'string') {\n    return style;\n  }\n\n  if ('toJS' in style) {\n    style = style.toJS();\n  }\n\n  if (!style.layers) {\n    return style;\n  }\n\n  const layerIndex = {};\n\n  for (const layer of style.layers) {\n    layerIndex[layer.id] = layer;\n  }\n\n  const layers = style.layers.map(layer => {\n    // @ts-expect-error\n    const layerRef = layerIndex[layer.ref];\n    let normalizedLayer = null;\n\n    if ('interactive' in layer) {\n      normalizedLayer = { ...layer\n      }; // Breaks style diffing :(\n\n      delete normalizedLayer.interactive;\n    } // Style diffing doesn't work with refs so expand them out manually before diffing.\n\n\n    if (layerRef) {\n      normalizedLayer = normalizedLayer || { ...layer\n      };\n      delete normalizedLayer.ref; // https://github.com/mapbox/mapbox-gl-js/blob/master/src/style-spec/deref.js\n\n      for (const propName of refProps) {\n        if (propName in layerRef) {\n          normalizedLayer[propName] = layerRef[propName];\n        }\n      }\n    }\n\n    return normalizedLayer || layer;\n  }); // Do not mutate the style object provided by the user\n\n  return { ...style,\n    layers\n  };\n}","map":null,"metadata":{},"sourceType":"module"}