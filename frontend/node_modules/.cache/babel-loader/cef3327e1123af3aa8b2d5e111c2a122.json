{"ast":null,"code":"/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal'; // Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\n\nfunction getClassList(className) {\n  return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\n\n\nfunction Popup(props) {\n  const {\n    map,\n    mapLib\n  } = useContext(MapContext);\n  const container = useMemo(() => {\n    return document.createElement('div');\n  }, []);\n  const thisRef = useRef({\n    props\n  });\n  thisRef.current.props = props;\n  const popup = useMemo(() => {\n    const options = { ...props\n    };\n    const pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n    pp.on('open', e => {\n      thisRef.current.props.onOpen?.(e);\n    });\n    pp.on('close', e => {\n      thisRef.current.props.onClose?.(e);\n    });\n    return pp;\n  }, []);\n  useEffect(() => {\n    popup.setDOMContent(container).addTo(map.getMap());\n    return () => {\n      if (popup.isOpen()) {\n        popup.remove();\n      }\n    };\n  }, []);\n  useEffect(() => {\n    applyReactStyle(popup.getElement(), props.style);\n  }, [props.style]);\n\n  if (popup.isOpen()) {\n    if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n      popup.setLngLat([props.longitude, props.latitude]);\n    } // @ts-ignore\n\n\n    if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n      popup.setOffset(props.offset);\n    } // @ts-ignore\n\n\n    if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n      // @ts-ignore\n      popup.options.anchor = props.anchor;\n      popup.setMaxWidth(props.maxWidth);\n    } // @ts-ignore\n\n\n    if (popup.options.className !== props.className) {\n      // @ts-ignore\n      const prevClassList = getClassList(popup.options.className);\n      const nextClassList = getClassList(props.className);\n\n      for (const c of prevClassList) {\n        if (!nextClassList.has(c)) {\n          popup.removeClassName(c);\n        }\n      }\n\n      for (const c of nextClassList) {\n        if (!prevClassList.has(c)) {\n          popup.addClassName(c);\n        }\n      } // @ts-ignore\n\n\n      popup.options.className = props.className;\n    }\n  }\n\n  return createPortal(props.children, container);\n} // @ts-ignore\n\n\nexport default React.memo(Popup);","map":{"version":3,"sources":["/Users/genie/code/chiutzuning/find-museum-app/frontend/node_modules/react-map-gl/dist/esm/components/popup.js"],"names":["React","createPortal","useEffect","useMemo","useRef","useContext","applyReactStyle","MapContext","deepEqual","getClassList","className","Set","trim","split","Popup","props","map","mapLib","container","document","createElement","thisRef","current","popup","options","pp","setLngLat","longitude","latitude","on","e","onOpen","onClose","setDOMContent","addTo","getMap","isOpen","remove","getElement","style","getLngLat","lng","lat","offset","setOffset","anchor","maxWidth","setMaxWidth","prevClassList","nextClassList","c","has","removeClassName","addClassName","children","memo"],"mappings":"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","sourcesContent":["/* global document */\nimport * as React from 'react';\nimport { createPortal } from 'react-dom';\nimport { useEffect, useMemo, useRef, useContext } from 'react';\nimport { applyReactStyle } from '../utils/apply-react-style';\nimport { MapContext } from './map';\nimport { deepEqual } from '../utils/deep-equal';\n// Adapted from https://github.com/mapbox/mapbox-gl-js/blob/v1.13.0/src/ui/popup.js\nfunction getClassList(className) {\n    return new Set(className ? className.trim().split(/\\s+/) : []);\n}\n/* eslint-disable complexity,max-statements */\nfunction Popup(props) {\n    const { map, mapLib } = useContext(MapContext);\n    const container = useMemo(() => {\n        return document.createElement('div');\n    }, []);\n    const thisRef = useRef({ props });\n    thisRef.current.props = props;\n    const popup = useMemo(() => {\n        const options = { ...props };\n        const pp = new mapLib.Popup(options).setLngLat([props.longitude, props.latitude]);\n        pp.on('open', e => {\n            thisRef.current.props.onOpen?.(e);\n        });\n        pp.on('close', e => {\n            thisRef.current.props.onClose?.(e);\n        });\n        return pp;\n    }, []);\n    useEffect(() => {\n        popup.setDOMContent(container).addTo(map.getMap());\n        return () => {\n            if (popup.isOpen()) {\n                popup.remove();\n            }\n        };\n    }, []);\n    useEffect(() => {\n        applyReactStyle(popup.getElement(), props.style);\n    }, [props.style]);\n    if (popup.isOpen()) {\n        if (popup.getLngLat().lng !== props.longitude || popup.getLngLat().lat !== props.latitude) {\n            popup.setLngLat([props.longitude, props.latitude]);\n        }\n        // @ts-ignore\n        if (props.offset && !deepEqual(popup.options.offset, props.offset)) {\n            popup.setOffset(props.offset);\n        }\n        // @ts-ignore\n        if (popup.options.anchor !== props.anchor || popup.options.maxWidth !== props.maxWidth) {\n            // @ts-ignore\n            popup.options.anchor = props.anchor;\n            popup.setMaxWidth(props.maxWidth);\n        }\n        // @ts-ignore\n        if (popup.options.className !== props.className) {\n            // @ts-ignore\n            const prevClassList = getClassList(popup.options.className);\n            const nextClassList = getClassList(props.className);\n            for (const c of prevClassList) {\n                if (!nextClassList.has(c)) {\n                    popup.removeClassName(c);\n                }\n            }\n            for (const c of nextClassList) {\n                if (!prevClassList.has(c)) {\n                    popup.addClassName(c);\n                }\n            }\n            // @ts-ignore\n            popup.options.className = props.className;\n        }\n    }\n    return createPortal(props.children, container);\n}\n// @ts-ignore\nexport default React.memo(Popup);\n//# sourceMappingURL=popup.js.map"]},"metadata":{},"sourceType":"module"}